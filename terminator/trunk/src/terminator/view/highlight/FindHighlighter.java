package terminator.view.highlight;

import java.awt.*;
import java.awt.event.*;
import java.util.regex.*;

import terminator.model.*;
import terminator.view.*;

/**
 * Highlights the results of user-initiated finds.
 */
public class FindHighlighter implements Highlighter {
	/** The highlighter pen style. */
	private final Style style = new Style(Color.black, Color.yellow, null, null);

	private Pattern pattern;
	
	public String getName() {
		return "Find Highlighter";
	}
	
	public void setRegularExpression(JTextBuffer view, String regularExpression) {
		view.removeHighlightsFrom(this, 0);
		if (regularExpression.length() > 0) {
			this.pattern = Pattern.compile(regularExpression);
			addHighlights(view, 0);
		}
	}
	
	public void forgetRegularExpression(JTextBuffer view) {
		view.removeHighlightsFrom(this, 0);
		this.pattern = null;
	}
	
	/** Request to add highlights to all lines of the view from the index given onwards. */
	public void addHighlights(JTextBuffer view, int firstLineIndex) {
		TextBuffer model = view.getModel();
		for (int i = firstLineIndex; i < model.getLineCount(); i++) {
			String line = model.getLine(i);
			addHighlights(view, i, line);
		}
	}
	
	private void addHighlights(JTextBuffer view, int lineIndex, String text) {
		if (pattern == null) {
			return;
		}
		Matcher matcher = pattern.matcher(text);
		while (matcher.find()) {
			Location start = new Location(lineIndex, matcher.start());
			Location end = new Location(lineIndex, matcher.end());
			Highlight highlight = new Highlight(this, start, end, style);
			view.addHighlight(highlight);
		}
	}

	/** Request to do something when the user clicks on a Highlight generated by this Highlighter. */
	public void highlightClicked(JTextBuffer view, Highlight highlight, String text, MouseEvent event) {
		return;
	}
}
