#!/bin/bash
TERMINATOR_HOME=`dirname $0`
CLASSPATH=$TERMINATOR_HOME/classes:$TERMINATOR_HOME/../salma-hayek/classes:$TERMINATOR_HOME/TerminatorN.jar
PTY_BINARY=$TERMINATOR_HOME/pty/pty-`uname`-`arch`

if [ ! -f ~/.terminator ]
then
  if [ "`uname`" == "Darwin" ]
  then
    PROPS_VARIANT=macosx
  elif ps -e | grep --quiet kde
  then
    PROPS_VARIANT=kde
  elif ps -e | grep --quiet gnome
  then
    PROPS_VARIANT=gnome
  else
    echo Failed to recognize your windowing environment - choosing a random set of defaults.
    echo Heh - the thought of randomness should get you reading that README file.
    # Well, at least the vi FileHighlighter is likely to work.
    PROPS_VARIANT=gnome
  fi
  cp $TERMINATOR_HOME/doc/props-examples/$PROPS_VARIANT.terminator ~/.terminator
fi

tic $TERMINATOR_HOME/doc/terminfo/terminator.tic

mkdir -p ~/.terminal-logs && chmod og-rx ~/.terminal-logs

# If we don't have a pre-compiled 'pty' program for this
# architecture, try to build it.
test -e $PTY_BINARY || make -C pty/

case "`uname`" in
Darwin)
    OS_SPECIFIC_OPTIONS=-Xdock:name=Terminator:icon=/Applications/Utilities/Terminal.app/Contents/Resources/icon.icns
    ;;
*)
    ;;
esac

exec java -cp $CLASSPATH $OS_SPECIFIC_OPTIONS -Dpty.binary=$PTY_BINARY terminatorn.Terminator "$@"
