<?xml version='1.0'?>
<Wix xmlns='http://schemas.microsoft.com/wix/2003/01/wi'>
  <Product Id='$(env.PRODUCT_GUID)'
  Name='$(env.HUMAN_PROJECT_NAME) $(env.VERSION_STRING)' Language='1033'
  UpgradeCode='$(env.UPGRADE_GUID)'
  Version='$(env.VERSION_STRING)'
  Manufacturer='software.jessies.org'>
    <Package Id='????????-????-????-????-????????????'
    Compressed='yes' InstallerVersion='150' />
    <Upgrade Id='$(env.UPGRADE_GUID)'>
    <UpgradeVersion Maximum='$(env.VERSION_STRING)' />
    </Upgrade>
    <Property Id='ALLUSERS' Value='2' />
    <Property Id="ARPCONTACT">software@jessies.org</Property>
    <Property Id='ARPNOMODIFY' Value='1' />
    <Property Id="ARPPRODUCTICON" Value='$(env.MACHINE_PROJECT_NAME).ico' />
    <Property Id="ARPURLINFOABOUT">
    http://software.jessies.org/$(env.MACHINE_PROJECT_NAME)/</Property>
    <Media Id='1' Cabinet='project.cab' EmbedCab='yes' />
    <Property Id='CYGWIN'>
      <RegistrySearch Id='RUBYW.dir' Root="HKLM" Key='Software\Cygnus Solutions\Cygwin\mounts v2\/' Name='native' Type='directory' />
    </Property>
    <Property Id='RUBYW'>
      <DirectorySearch Id='RUBYW.dir' Path='[CYGWIN]\bin' Depth='0'>
        <FileSearch Id='RUBYW.file' Name='rubyw.exe' />
      </DirectorySearch>
    </Property>
    <Condition Message="Cygwin and Cygwin Ruby must be installed (for all users)"><![CDATA[CYGWIN AND RUBYW]]></Condition>
    <Directory Id='TARGETDIR' Name='SourceDir'>
      <Directory Id='ProgramFilesFolder' Name='Name'
      LongName='Program Files'>
        <Directory Id='company' Name='Name'
        LongName='software.jessies.org'>
          <Directory Id='product' Name='Name'
          LongName='$(env.MACHINE_PROJECT_NAME)'>
            <?include component-definitions.wxi ?>
            <Directory Id='Resources' Name='Name'
            LongName='Resources'>
            <Directory Id='projectResources' Name='Name'
            LongName='$(env.MACHINE_PROJECT_NAME)'>
            <Directory Id='bin' Name='Name'
            LongName='bin'>
              <Component Id='Path'
              Guid='$(env.PATH_GUID)'>
                <CreateFolder />
                <Environment Id='UpdatePath' Name='PATH' Action='create' System='yes' Part='last' Value='[bin]' />
              </Component>
            </Directory>
            </Directory>
            </Directory>
          </Directory>
        </Directory>
      </Directory>
      <Directory Id='DesktopFolder' Name='Desktop' />
      <Component Id='RubyShortcut'
      Guid='$(env.SHORTCUT_HKCU_GUID)'>
        <Registry Id='RegistryKey' Root='HKCU'
        Key='Software\software.jessies.org\$(env.MACHINE_PROJECT_NAME)'
        Name='ShortcutTarget' Action='write' Type='string'
        Value='[RUBYW]' KeyPath='yes' />
        <Shortcut Id='DesktopShortcutId' Directory='DesktopFolder'
        Name='Name' LongName='$(env.HUMAN_PROJECT_NAME)' Target='[RUBYW]'
        Arguments='bin/$(env.MACHINE_PROJECT_NAME)' WorkingDirectory='projectResources'
        Icon='$(env.MACHINE_PROJECT_NAME).ico' />
      </Component>
    </Directory>
    <Feature Id='product' Title='$(env.HUMAN_PROJECT_NAME)' Level='1'>
      <ComponentRef Id='RubyShortcut' />
      <ComponentRef Id='Path' />
      <?include component-references.wxi ?>
    </Feature>
    <InstallExecuteSequence>
      <RemoveExistingProducts After='InstallInitialize' />
    </InstallExecuteSequence>
    <Icon Id='$(env.MACHINE_PROJECT_NAME).ico'
    src='Resources/$(env.MACHINE_PROJECT_NAME)/lib/$(env.MACHINE_PROJECT_NAME).ico' />
  </Product>
</Wix>
