#!/usr/bin/ruby -w
# Opens files in Edit.
# @author Elliott Hughes <enh@acm.org>

require 'net/telnet'

def openFileOnLocalhost(filename)
    host = ENV["EDIT_HOME_SERVER"]
    if host == nil then
        host = 'localhost'
    end
    
    begin
        telnet = Net::Telnet.new('Host' => host, 'Port' => 1948, 'Telnetmode' => false)
        telnet.puts("open #{filename}\r")
        print(telnet.readlines().join("\n"))
        telnet.close()
    rescue
        # Defer to the next 'vi' on the path if we failed.
        us = $0
        system("`type -p -a vi | xargs -n1 readlink -f | grep -v #{us} | uniq | tail +2 | head -1` #{filename}")
    end
end

ARGV.each {
    | filename |
    openFileOnLocalhost(File.expand_path(filename))
}
